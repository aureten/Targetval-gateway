{
  "openapi": "3.1.0",
  "info": {
    "title": "TargetVal Gateway",
    "version": "2025.10-final",
    "description": "Biologic target validation API gateway with 55 live modules across 6 domains (Genetics, Assoc/Expression, Mechanism, Tractability, Safety, Clinical/Comp). Each module fetches real-time data from public biomedical APIs."
  },
  "servers": [
    {
      "url": "https://targetval-gateway.onrender.com/v1",
      "description": "Production server"
    }
  ],
  "paths": {
    "/healthz": {
      "get": {
        "operationId": "healthCheck",
        "summary": "Health check",
        "description": "Check API health and get module count",
        "tags": ["system"],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {"type": "boolean"},
                    "modules": {"type": "integer"},
                    "version": {"type": "string"}
                  }
                }
              }
            }
          }
        }
      }
    },
    "/modules": {
      "get": {
        "operationId": "listModules",
        "summary": "List all 55 module keys",
        "description": "Returns array of all available module identifiers",
        "tags": ["system"],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {"type": "string"}
                }
              }
            }
          }
        }
      }
    },
    "/module": {
      "post": {
        "operationId": "runModule",
        "summary": "Run a single module by key",
        "description": "Execute one of the 55 modules with POST request",
        "tags": ["modules"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["module_key"],
                "properties": {
                  "module_key": {
                    "type": "string",
                    "description": "Module identifier (e.g., 'genetics-l2g', 'expr-baseline')"
                  },
                  "gene": {"type": "string", "description": "Gene symbol or ID"},
                  "symbol": {"type": "string", "description": "Gene symbol"},
                  "ensembl": {"type": "string", "description": "Ensembl gene ID"},
                  "efo": {"type": "string", "description": "EFO disease ID"},
                  "condition": {"type": "string", "description": "Disease/condition name"},
                  "limit": {"type": "integer", "default": 50, "minimum": 1, "maximum": 1000},
                  "extra": {"type": "object", "additionalProperties": true}
                }
              },
              "examples": {
                "genetics": {
                  "value": {
                    "module_key": "genetics-l2g",
                    "symbol": "IL6",
                    "condition": "ulcerative colitis",
                    "limit": 50
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Module execution result",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {"type": "string"},
                    "source": {"type": "string"},
                    "fetched_n": {"type": "integer"},
                    "data": {"type": "object"},
                    "citations": {"type": "array", "items": {"type": "string"}},
                    "fetched_at": {"type": "string"}
                  }
                }
              }
            }
          }
        }
      }
    },
    "/module/{name}": {
      "get": {
        "operationId": "runModuleGet",
        "summary": "Run a module with GET",
        "description": "Execute one of the 55 modules using GET parameters",
        "tags": ["modules"],
        "parameters": [
          {
            "name": "name",
            "in": "path",
            "required": true,
            "schema": {"type": "string"},
            "description": "Module key"
          },
          {
            "name": "gene",
            "in": "query",
            "schema": {"type": "string"},
            "description": "Gene symbol or ID"
          },
          {
            "name": "symbol",
            "in": "query",
            "schema": {"type": "string"},
            "description": "Gene symbol"
          },
          {
            "name": "ensembl",
            "in": "query",
            "schema": {"type": "string"},
            "description": "Ensembl ID"
          },
          {
            "name": "efo",
            "in": "query",
            "schema": {"type": "string"},
            "description": "EFO disease ID"
          },
          {
            "name": "condition",
            "in": "query",
            "schema": {"type": "string"},
            "description": "Disease/condition"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {"type": "integer", "default": 50, "minimum": 1, "maximum": 1000}
          }
        ],
        "responses": {
          "200": {
            "description": "Module result",
            "content": {
              "application/json": {
                "schema": {"type": "object"}
              }
            }
          }
        }
      }
    },
    "/aggregate": {
      "post": {
        "operationId": "aggregateModules",
        "summary": "Run multiple modules",
        "description": "Execute multiple modules sequentially or in parallel, with optional domain filtering",
        "tags": ["modules"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "modules": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "List of module keys to run"
                  },
                  "domain": {
                    "oneOf": [
                      {"type": "integer", "minimum": 1, "maximum": 6},
                      {"type": "string", "pattern": "^D?[1-6]$"}
                    ],
                    "description": "Domain filter: 1=Genetics, 2=Assoc, 3=Expression, 4=Tractability, 5=Safety, 6=Clinical"
                  },
                  "primary_only": {"type": "boolean", "default": true},
                  "order": {
                    "type": "string",
                    "enum": ["sequential", "parallel"],
                    "default": "sequential"
                  },
                  "continue_on_error": {"type": "boolean", "default": true},
                  "gene": {"type": "string"},
                  "symbol": {"type": "string"},
                  "ensembl_id": {"type": "string"},
                  "efo": {"type": "string"},
                  "condition": {"type": "string"},
                  "limit": {"type": "integer", "default": 50},
                  "species": {"type": "integer"},
                  "cutoff": {"type": "number"},
                  "extra": {"type": "object"}
                }
              },
              "examples": {
                "domain1": {
                  "summary": "Domain 1 (Genetics)",
                  "value": {
                    "domain": 1,
                    "symbol": "PCSK9",
                    "condition": "hypercholesterolemia",
                    "order": "sequential",
                    "limit": 50
                  }
                },
                "multiModule": {
                  "summary": "Specific modules",
                  "value": {
                    "modules": ["genetics-l2g", "expr-baseline", "mech-ppi"],
                    "symbol": "IL6",
                    "condition": "ulcerative colitis",
                    "order": "parallel"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Aggregated results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "query": {"type": "object"},
                    "results": {
                      "type": "object",
                      "additionalProperties": {"type": "object"}
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/domain/{domain_id}/run": {
      "post": {
        "operationId": "runDomain",
        "summary": "Run all modules in a domain",
        "description": "Execute all primary modules for a specific domain (1-6) sequentially",
        "tags": ["modules"],
        "parameters": [
          {
            "name": "domain_id",
            "in": "path",
            "required": true,
            "schema": {"type": "integer", "minimum": 1, "maximum": 6},
            "description": "Domain: 1=Genetics, 2=Assoc, 3=Expression, 4=Tractability, 5=Safety, 6=Clinical"
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "gene": {"type": "string"},
                  "symbol": {"type": "string"},
                  "ensembl_id": {"type": "string"},
                  "efo": {"type": "string"},
                  "condition": {"type": "string"},
                  "limit": {"type": "integer", "default": 50},
                  "primary_only": {"type": "boolean", "default": true}
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Domain results",
            "content": {
              "application/json": {
                "schema": {"type": "object"}
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Evidence": {
        "type": "object",
        "properties": {
          "status": {"type": "string", "enum": ["OK", "NO_DATA", "ERROR"]},
          "source": {"type": "string"},
          "fetched_n": {"type": "integer"},
          "data": {"type": "object"},
          "citations": {"type": "array", "items": {"type": "string"}},
          "fetched_at": {"type": "string", "format": "date-time"}
        }
      }
    }
  }
}
